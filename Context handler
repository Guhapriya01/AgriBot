response = Map();
//info answers;
response.put("action","context");
response.put("context_id",context_id);
if(context_id.equals("browsing"))
{
	others = answers.get("others").get("text");
	if(others.equalsIgnoreCase("Farmer"))
	{
		if(!answers.containsKey("farm_query"))
		{
			question = {"name":"farm_query","replies":{"Nice! I have a very good explanation guide for you. Can I send it to you?"},"input":{"type":"select","options":{"Email me","No, Thanks"}}};
			response.put("questions",{question});
		}
		else
		{
			farm_query = answers.get("farm_query").get("text");
			if(farm_query.equals("Email me"))
			{
				if(!answers.containsKey("email"))
				{
					question = {"name":"email","replies":{"Can I have your email ?"},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
					response.put("questions",{question});
				}
				else
				{
					email = answers.get("email").get("text");
					json_text = "{\"data\":[{\"Name\":\"GoAgro\"}]}";
					merge_values = Map();
					merge_values.put("subject","Farmers Guide");
					merge_values.put("merge_data",json_text);
					writer_response = zoho.writer.mergeAndSend("pykvl4fceb13c034f4a2983eb29d2a7662e41","inline",email,merge_values,"zohowriter_connection");
					response.put("action","end");
					response.put("replies",{"The guide is on it's' way. We hope you found something that your sparked interest.",":) Happy farming !"});
				}
			}
			else
			{
				response.put("action","end");
				response.put("replies",{"Okay :) Happy farming !"});
			}
		}
	}
	else if(others.equalsIgnoreCase("Customer"))
	{
		if(!answers.containsKey("cust_query"))
		{
			question = {"name":"cust_query","replies":{"Good! I have a list of products that are available and a customer guide for you. Which can I send to you?"},"input":{"type":"select","options":{"Guide","Product list"}}};
			response.put("questions",{question});
		}
		else
		{
			cust_query = answers.get("cust_query").get("text");
			if(!answers.containsKey("email"))
			{
				question = {"name":"email","replies":{"Can I have your email ?"},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
				response.put("questions",{question});
			}
			else
			{
				email = answers.get("email").get("text");
				if(cust_query.equals("Product list"))
				{
					queryValue = Map();
					queryValue.put("start_index","1");
					response_record = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",queryValue);
					records = response_record.get("records");
					range = List();
					test = "";
					count = 1;
					for each  item in records
					{
						range.add(item);
					}
					for each  i in range
					{
						test = test + toString(count) + "." + toString(i.get("type")) + " - ";
						test = test + "Quantity Available :" + toString(i.get("quantity")) + " and ";
						test = test + "Price Per Kilogram :" + toString(i.get("price per kg")) + "<br><br>";
						count = count + 1;
					}
					sendmail
					[
						from :zoho.adminuserid
						to :email
						subject :"Product List"
						message :"Dear GoAgro User &#128151; , <br>" + "<br>The product list that you have asked for is here for you!<br><br>" + test + "<br>&#128512; Happy Farming!!!"
					]
					response.put("action","end");
					response.put("replies",{"The product list is on it's way. We hope you found something that your sparked interest.",":) Happy Farming!"});
				}
				else
				{
					json_text = "{\"data\":[{\"Name\":\"GoAGro\"}]}";
					merge_values = Map();
					merge_values.put("subject","Customers Guide");
					merge_values.put("merge_data",json_text);
					response_writer = zoho.writer.mergeAndSend("26azlb2fe872e726d40858d98bacc64d5cd2c","inline",email,merge_values,"zohowriter_connection");
					response.put("action","end");
					response.put("replies",{"The guide is on it's way. We hope you found something that your sparked interest."," :) Happy farming !"});
				}
			}
		}
	}
}
else if(context_id.equals("farm"))
{
	farm_actions = answers.get("farm_actions").get("text");
	if(farm_actions.equals("Register"))
	{
		if(!answers.containsKey("sell_crop"))
		{
			question = {"name":"sell_crop","replies":{"Good! What do you wish to sell ?"},"input":{"type":"select","options":{"Paddy","Millets","Fruits","Vegetables","Pulses","Spices & Condiments"}}};
			response.put("questions",{question});
		}
		else
		{
			sell_actions = answers.get("sell_crop").get("text");
			if(!answers.containsKey("type_crop"))
			{
				if(sell_actions.equals("Paddy"))
				{
					question = {"name":"type_crop","replies":{"Types of Paddy"},"input":{"type":"select","options":{"Kuruvai","Navari/Kodai","Samba"}}};
					response.put("questions",{question});
				}
				else if(sell_actions.equals("Millets"))
				{
					question = {"name":"type_crop","replies":{"Types of Millets"},"input":{"type":"select","options":{"Ragi","Maize","Samai","Cholam(Jowar)","Cumbu(Bajra)","Varagu","Korra"}}};
					response.put("questions",{question});
				}
				else if(sell_actions.equals("Fruits"))
				{
					question = {"name":"type_crop","replies":{"Types of Fruits"},"input":{"type":"select","options":{"Mango","Banana","Guava","Lemon","Cashewnut","Jackfruit","Grapes","Orange","Pine apple"}}};
					response.put("questions",{question});
				}
				else if(sell_actions.equals("Vegetables"))
				{
					question = {"name":"type_crop","replies":{"Types of Vegetables"},"input":{"type":"select","options":{"Tapioca","Tomato","Onion","Brinjal","Lady's Finger","Potato","Cabbage","Sweet potato"}}};
					response.put("questions",{question});
				}
				else if(sell_actions.equals("Pulses"))
				{
					question = {"name":"type_crop","replies":{"Type of Pulses"},"input":{"type":"select","options":{"Black gram","Green gram","Red gram","Horse gram","Bengal gram"}}};
					response.put("questions",{question});
				}
				else if(sell_actions.equals("Spices & Condiments"))
				{
					question = {"name":"type_crop","replies":{"Type of Spices & Condiments"},"input":{"type":"select","options":{"Chillies(Dry)","Tamarid","Turmeric(Cured)","Pepper","Arecanut","Coiandern(Grains)","Cardomom","Cloves","Ginger"}}};
					response.put("questions",{question});
				}
			}
			else
			{
				type_crop = answers.get("type_crop").get("text");
				if(!answers.containsKey("amount"))
				{
					question = {"name":"amount","replies":{"Wow! I love " + type_crop + " so much!","How much do you have? Note: In kilogram "},"input":{"type":"slider","values":{"0","5","10","15","20","25","30","35","40","45","50","55","60","65","70","75","80","90","100"}}};
					response.put("questions",{question});
				}
				else
				{
					amount = answers.get("amount").get("text");
					if(!answers.containsKey("price"))
					{
						question = {"name":"price","replies":{"May I know the price per kilogram ?"}};
						response.put("questions",{question});
					}
					else
					{
						price = answers.get("price").get("text");
						if(!answers.containsKey("loc"))
						{
							question = {"name":"loc","replies":{"Choose your location"},"input":{"type":"location"}};
							response.put("questions",{question});
						}
						else
						{
							locat = answers.get("loc").get("text");
							if(!answers.containsKey("detailn_farm"))
							{
								question = {"name":"detailn_farm","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
								response.put("questions",{question});
							}
							else
							{
								detn_farm = answers.get("detailn_farm").get("text");
								if(!answers.containsKey("detailp_farm"))
								{
									question = {"name":"detailp_farm","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
									response.put("questions",{question});
								}
								else
								{
									detp_farm = answers.get("detailp_farm").get("text");
									if(!answers.containsKey("email"))
									{
										question = {"name":"email","replies":{"Can you give me your mail id ?"},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
										response.put("questions",{question});
									}
									else
									{
										email = answers.get("email").get("text");
										if(!answers.containsKey("submit"))
										{
											question = {"name":"submit","replies":{"Check your details and confirm !","Name :" + detn_farm,"Phone :" + detp_farm,"Address :" + locat,"Email :" + email,"Crop :" + sell_actions,"Type of crop :" + type_crop,"Price per kilogram :" + price,"Quantity :" + amount},"input":{"type":"select","options":{"Confirm","Nope"}}};
											response.put("questions",{question});
										}
										else
										{
											submit = answers.get("submit").get("text");
											if(submit.equals("Confirm"))
											{
												last = detn_farm + "," + detp_farm + "," + "\"" + locat + "\"" + "," + sell_actions + "," + amount + "," + price + "," + type_crop + "," + email;
												response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",last);
												queryValue = Map();
												value_0 = "\"availability\"=\"no\" and \"type\"=\"" + type_crop + "\"";
												queryValue.put("criteria",value_0);
												queryValue.put("start_index","1");
												response_0 = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",queryValue);
												return_0 = response_0.get("records");
												if(return_0.size() == 1)
												{
													details_0 = return_0.toCollection();
													mail_0 = details_0.get("Email");
													name_0 = details_0.get("Name");
													sendmail
													[
														from :zoho.adminuserid
														to :mail_0
														subject :"GoAgro - Product Available Now!"
														message :"Dear Customer, " + "<br>The product that you have asked for is now in stock !" + "<br> You can now visit goagro to buy the product." + "<br>Happy Farming!!!"
													]
													new_values = Map();
													new_values.put("availability","yes");
													response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",value_0,new_values);
													response.put("action","end");
													response.put("replies",{"Information collected successfully. You will be informed through mail when customer orders your product."," :) Happy Farming !"});
												}
												else if(return_0.size() > 1)
												{
													range = List();
													names_list = List();
													mails_list = List();
													for each  item in return_0
													{
														range.add(item);
													}
													for each  i in range
													{
														mails_list.add(i.get("Email"));
														names_list.add(i.get("Name"));
													}
													sendmail
													[
														from :zoho.adminuserid
														to :mails_list
														subject :"GoAgro - Product Available Now!"
														message :"Dear Customer, " + "<br>The product that you have asked for is now in stock !" + "<br> You can now visit goagro to buy the product." + "<br>Happy Farming!!!"
													]
													new_values = Map();
													new_values.put("availability","yes");
													response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",value_0,new_values);
													response.put("action","end");
													response.put("replies",{"Information collected successfully. You will be informed through mail when customer orders your product."," :) Happy Farming !"});
												}
												else
												{
													response.put("action","end");
													response.put("replies",{"Information collected successfully. You will be informed through mail when customer orders your product."," :) Happy Farming !"});
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Okay :) Happy Farming!"});
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	else if(farm_actions.equals("Weather Forecast"))
	{
		if(!answers.containsKey("w_loc"))
		{
			question = {"name":"w_loc","replies":{"Can you give me the name of your city ( Example: Chennai)"}};
			response.put("questions",{question});
		}
		else
		{
			w_loc = answers.get("w_loc").get("text");
			ur = "https://api.openweathermap.org/data/2.5/weather?quantity=" + w_loc + "&appid=53bb525864ca2f042e8fa49cba6d1e15";
			resp_open = invokeurl
			[
				url :ur
				type :GET
				connection:"openweather_connection"
			];
			h = resp_open.get("main");
			temp = h.get("temp");
			humidity = h.get("humidity");
			pressure = h.get("pressure");
			response.put("action","end");
			response.put("replies",{"Here is the weather forecast for today !","Temparature : " + temp,"Humidity : " + humidity,"Pressure : " + pressure," :)  Happy Farming! "});
			return response;
		}
	}
	else if(farm_actions.equals("Crop Recommendation"))
	{
		response.put("action","reply");
		response.put("replies",{"Ah! It's seems very intersting! isn't it?",{"text":"Link to know which crop is suitable for your environment is given below.","image":"https://camo.githubusercontent.com/2d68d3be007f541e5442bdfaead86df1dce922447380aad04e82a2509823e1cf/68747470733a2f2f7777772e6f70656e6465692e65752f77702d636f6e74656e742f75706c6f6164732f323032302f31312f696d672d59616e65776e304f52574378344a6c6d2d773830302e6a7067","type":"links","links":{{"url":"http://crop-recommend-model.herokuapp.com","text":"Click here to check"}}}});
		return response;
	}
	else if(farm_actions.equals("Soil Testing Labs"))
	{
		if(!answers.containsKey("stl"))
		{
			question = {"name":"stl","replies":{"Nice. We have the location details for you. For which Soil Testing Laboratories (STL) do you want to know ? "},"input":{"type":"select","options":{"Direct STL","Mobile STL"}}};
			response.put("questions",{question});
		}
		else
		{
			stl = answers.get("stl").get("text");
			if(!answers.containsKey("d_stl"))
			{
				if(stl.equals("Direct STL"))
				{
					question = {"name":"d_stl","replies":{"Select your location"},"input":{"type":"drop-down","placeholder":"Choose a location","options":{{"value":"0","label":"Cuddalore"},{"value":"1","label":"Kanchipuram"},{"value":"2","label":"Vellore"},{"value":"3","label":"Dharmapuri"},{"value":"4","label":"Salem"},{"value":"5","label":"Coimbatore"},{"value":"6","label":"Pudukkottai"},{"value":"7","label":"Erode"},{"value":"8","label":"Trichy"},{"value":"9","label":"Madurai"},{"value":"10","label":"Aduthurai"},{"value":"11","label":"Theni"},{"value":"12","label":"Dindigul"},{"value":"13","label":"Sivagangai"},{"value":"14","label":"Paramakudi"},{"value":"15","label":"Thirunelveli"},{"value":"16","label":"Thoothukudi"},{"value":"17","label":"Nagarkoil"},{"value":"18","label":"Ooty"},{"value":"19","label":"Namakkal"},{"value":"20","label":"Thiruvarur"},{"value":"21","label":"Thiruvallur"},{"value":"22","label":"Perambalur"},{"value":"23","label":"Krishnagiri"},{"value":"24","label":"Virudunagar"},{"value":"25","label":"Karur"},{"value":"26","label":"Ariyalur"},{"value":"27","label":"Nagapattinam"},{"value":"28","label":"Villupuram"},{"value":"29","label":"Thiruvannamalai"}},"select_label":"Select","min_selection":1,"max_selection":1}};
					response.put("questions",{question});
				}
				else if(stl.equals("Mobile STL"))
				{
					question = {"name":"d_stl","replies":{"Select your location"},"input":{"type":"drop-down","placeholder":"Choose a location","options":{{"value":"0","label":"Thiruvallur"},{"value":"1","label":"Thiruvannamalai"},{"value":"2","label":"Villupuram"},{"value":"3","label":"Krishanagiri"},{"value":"4","label":"Tirupur"},{"value":"5","label":"Erode"},{"value":"6","label":"Madurai"},{"value":"7","label":"Perambalur"},{"value":"8","label":"Karur"},{"value":"9","label":"Namakkal"},{"value":"10","label":"Thiruvarur"},{"value":"11","label":"Paramakudi"},{"value":"12","label":"Thoothukudi"},{"value":"13","label":"Nagarkoil"},{"value":"14","label":"Nagapattinam"},{"value":"15","label":"Virudunagar"}},"select_label":"Select","min_selection":1,"max_selection":1}};
					response.put("questions",{question});
				}
			}
			else
			{
				d_stl = answers.get("d_stl").get("text");
				if(stl.equals("Direct STL"))
				{
					sheet = "Direct";
				}
				else
				{
					sheet = "Mobile";
				}
				queryValue = Map();
				d_val = "\"Name\"=\"" + d_stl + "\" and \"type\"=\"" + sheet + "\"";
				queryValue.put("criteria",d_val);
				queryValue.put("start_index","1");
				response_get = zoho.sheet.getRecords("5na570db1cae141e841a385f931510ec6c84e","Sheet3",queryValue);
				returned = response_get.get("records");
				details_stl = returned.toCollection();
				place = details_stl.get("Place");
				response.put("action","end");
				response.put("replies",{"I'm searching for you..","I found it! The address is here.",place," :) Happy Farming! "});
			}
		}
	}
	else if(farm_actions.equals("Schemes"))
	{
		if(!answers.containsKey("Schem"))
		{
			question = {"name":"Schem","replies":{"Here is the list of scheme categories. Select the one you want to know."},"input":{"type":"drop-down","options":{{"value":"0","label":"Distribution"},{"value":"1","label":"Training"},{"value":"2","label":"Subsidy"},{"value":"3","label":"Demonstration"},{"value":"4","label":"Livelihood Activities"},{"value":"5","label":"Water"},{"value":"6","label":"Rebate/Reimbursement"},{"value":"7","label":"Loan/Fund"},{"value":"8","label":"Production"},{"value":"9","label":"Reservation"},{"value":"10","label":"Others"}},"select_label":"Select","min_selection":1,"max_selection":1}};
			response.put("questions",{question});
		}
		else
		{
			Schem = answers.get("Schem").get("text");
			queryValue = Map();
			sch_val = "\"Category\"=\"" + Schem + "\"";
			queryValue.put("criteria",sch_val);
			queryValue.put("start_index","1");
			response_get = zoho.sheet.getRecords("puk99dd72ffbbc14d4d85b370dec2eab0e0c4","Sheet1",queryValue);
			query = response_get.get("records");
			range = List();
			names_list = List();
			for each  item in query
			{
				range.add(item);
			}
			ved = "";
			for each  i in range
			{
				names_list.add(i.get("Names"));
				ved = ved + i.get("Names") + "@";
			}
			vedlist = ved.toList("@");
			if(!answers.containsKey("yourc"))
			{
				question = {"name":"yourc","replies":{"Government schemes under the category - " + Schem},"input":{"type":"select","options":vedlist}};
				response.put("questions",{question});
			}
			else
			{
				yourc = answers.get("yourc").get("text");
				index_selected = vedlist.indexOf(yourc);
				sc_name = names_list.get(index_selected);
				query_Value = Map();
				name_criteria = "\"Names\"=\"" + sc_name + "\"";
				query_Value.put("criteria",name_criteria);
				query_Value.put("start_index","1");
				response_get = zoho.sheet.getRecords("puk99dd72ffbbc14d4d85b370dec2eab0e0c4","Sheet1",query_Value);
				records = response_get.get("records");
				details_collection = records.toCollection();
				qa = details_collection.get("Links");
				if(!answers.containsKey("linkschemes"))
				{
					question = {"name":"linkschemes","replies":{{"text":"Here is the link!","type":"links","links":{{"text":"Click here to know","url":qa}}}}};
					response.put("questions",{question});
					return response;
				}
			}
		}
	}
	else if(farm_actions.equals("Direct Purchase Centres"))
	{
		if(!answers.containsKey("st_act"))
		{
			question = {"name":"st_act","replies":{"Nice! What do you wish to do? "},"input":{"type":"select","options":{"Register DPC","Location Details"}}};
			response.put("questions",{question});
		}
		else
		{
			st_act = answers.get("st_act").get("text");
			if(st_act.equals("Register DPC"))
			{
				if(!answers.containsKey("instructions"))
				{
					question = {"name":"instructions","replies":{{"text":"Link to register for Direct Purchase Centre is given below.","type":"links","links":{{"text":"Click here","url":"https://www.tncsc-edpc.in/Account/Login"}}}}};
					response.put("questions",{question});
					return response;
				}
			}
			else
			{
				if(!answers.containsKey("st_loc"))
				{
					question = {"name":"st_loc","replies":{"Select your district from the available options.","Note: Only for delta regions"},"input":{"type":"select","options":{"Nagapatinam","Thanjavur","Thiruvarur"}}};
					response.put("questions",{question});
				}
				else
				{
					st_loc = answers.get("st_loc").get("text");
					if(st_loc.equals("Nagapatinam"))
					{
						if(!answers.containsKey("st_taluk"))
						{
							question = {"name":"st_taluk","replies":{"Select your taluk"},"input":{"type":"select","options":{"Nagappattinam Taluk","Keevalur Taluk","Thirukkuvalai Taluk","Vedharanyam Taluk","Mayiladuthurai Taluk","Tharangabadi Taluk","Sirkali Taluk"}}};
							response.put("questions",{question});
						}
						else
						{
							st_taluk = answers.get("st_taluk").get("text");
							if(!answers.containsKey("st_name"))
							{
								if(st_taluk.equals("Nagappattinam Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Seeyathamangai","Thirumarugal","Thirupugalore","Thirupayathangudi","Puducherry","Melapoothanur"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Keevalur Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Pattamangalam","Thirupoondi","Killukudi","Karunkanni","Mohanur","Cholavidyapuram","Venmani","Thevoor","Kohur","Keelaiyur"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Thirukkuvalai Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Thirukkuvalai","Vazhakkarai","Kothangudi","Aymoor","Marachery","Arunthavampulam","Vadugoor","Neermoolai","Valivalam","Athamangalam","Sithaimoor"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Vedharanyam Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Voimedu","Oradiyambalam","Thalanayar","Thanikkottagam","Umbalachery"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Mayiladuthurai Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Komal","Palayakoodalore","Mekkirimangalam","Valuvoor","Melamanganallur","Kokkur","Thirumangalam","Therilandur","Palayur","Malliam"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Sirkali Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Nangoor","81 Keelaiyur","Madhanam","Valluvakudi","Edakkudi Vadapathi  (vaitheeswarankoil)","Panankattankudi"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Tharangabadi Taluk"))
								{
									st_name = "Tharangabadi Taluk";
								}
							}
							else
							{
								st_name = answers.get("st_name").get("text");
								queryValue = Map();
								tlk = "\"Taluk\"=\"" + st_taluk + "\" and \"Name\"=\"" + st_name + "\"";
								queryValue.put("criteria",tlk);
								queryValue.put("start_index","1");
								response_get = zoho.sheet.getRecords("5na57a9fd75df4b164676bc824d0320516243","Sheet1",queryValue);
								query = response_get.get("records");
								details_farmer = query.toCollection();
								address = details_farmer.get("Address");
								response.put("action","end");
								response.put("replies",{"Address is here for you",address," :) Happy Farming!"});
							}
						}
					}
					else if(st_loc.equals("Thanjavur"))
					{
						if(!answers.containsKey("st_taluk"))
						{
							question = {"name":"st_taluk","replies":{"Select your taluk"},"input":{"type":"select","options":{"Thanjavur Taluk","Thiruvaiyaru Taluk","Orathanadu Taluk","Pattukkottai Taluk","Peravurani Taluk","Kumbakonam Taluk","Thiruvadaimarthur Taluk","Papanasam Taluk"}}};
							response.put("questions",{question});
						}
						else
						{
							st_taluk = answers.get("st_taluk").get("text");
							if(!answers.containsKey("st_name"))
							{
								if(st_taluk.equals("Thanjavur Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Kallaperumpur","Sakkarasamandam","Thittai","Mariyamman Koil","Madigai","Mathur","Thennankudi","Chithirakudi","Puthalur","Kulichapattu"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Thiruvaiyaru Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Thiruvaiyaru","Kanchamangalam","Nadukaveri","Vishnampettai","Vinnam Mangalam","Palaya Arcot","Ilangana","Mela Thirupanthurithi","Vellamperambur","Thenperamber"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Orathanadu Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"drop-down","options":{{"value":"0","label":"Thekkur"},{"value":"1","label":"Vadacheri"},{"value":"2","label":"Cholapuram"},{"value":"3","label":"Ponnappur"},{"value":"4","label":"Tondarampattu"},{"value":"5","label":"Vadakkur"},{"value":"6","label":"Mandalakkottai"},{"value":"7","label":"Pinnaiyur"},{"value":"8","label":"Thirumangalam"},{"value":"9","label":"Thirumangalakotai"},{"value":"10","label":"Kannukkudi"},{"value":"11","label":"Kannanththukudi"},{"value":"12","label":"Kulamangalam"},{"value":"13","label":"Neivasal"},{"value":"14","label":"Thennamanadu"},{"value":"15","label":"Okkanadu"},{"value":"16","label":"Chadaiyar Koil"},{"value":"17","label":"Morthiampalpuram"},{"value":"18","label":"Keelvuloor"},{"value":"19","label":"Paikaruppankottai"},{"value":"20","label":"Panayakkottai"},{"value":"21","label":"Athana Kottai"},{"value":"22","label":"Kannanthangudi North"},{"value":"23","label":"Vandaiyaniruppu"},{"value":"24","label":"Pudur (orathanadu)"},{"value":"25","label":"Pulavankadu"}},"select_label":"Select","min_selection":1,"max_selection":1}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Pattukkottai Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Athambai","Nambi Vayal","Nattusalai","Siraimelkudi","Keeladurichi","Kurichi","Alamathi Kadu","Vikram","Alivalam","Pannvayal","Athivethi","Thamarakkottai","Poovalur","Madukkur","Kayavoor"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Peravurani Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Perumagalam","Manakkadu","Ovumatha Nadu","Irrattai Vayal","Kurvikkarambai","Peravurani"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Kumbakonam Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Asoor","Kallur ","Cholapuram"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Thiruvadaimarthur Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Mullahkudi","Thiruvadaimarthur"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Papanasam Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Melattur","Ammanpettai","Poondi","Annappan pettai","Thirukkarukkavur","Karuppan Mudathailar pettai (Post)","Arunthuvapuram","Uthamarkudi","Udayarkoil","Irumbuthalai","Mariamman koil","Shenbagapuram","Salaimangalam","Vullikkadai","Papansam (Gopurajapuram)","Kalancheri"}}};
									response.put("questions",{question});
								}
							}
							else
							{
								st_name = answers.get("st_name").get("text");
								queryValue = Map();
								tlk = "\"Taluk\"=\"" + st_taluk + "\" and \"Name\"=\"" + st_name + "\"";
								queryValue.put("criteria",tlk);
								queryValue.put("start_index","1");
								response_get = zoho.sheet.getRecords("5na57a9fd75df4b164676bc824d0320516243","Sheet1",queryValue);
								query = response_get.get("records");
								details_farmer = query.toCollection();
								address = details_farmer.get("Address");
								response.put("action","end");
								response.put("replies",{"Address is here for you ",address," :) Happy Farming!"});
							}
						}
					}
					else if(st_loc.equals("Thiruvarur"))
					{
						if(!answers.containsKey("st_taluk"))
						{
							question = {"name":"st_taluk","replies":{"Select your taluk"},"input":{"type":"select","options":{"Thiruvarur Taluk","Nannilam Taluk","Kodavasal Taluk","Valangaiman Taluk","Mannargudi Taluk","Needamangalam Taluk","Thiruthuraipoondi Taluk"}}};
							response.put("questions",{question});
						}
						else
						{
							st_taluk = answers.get("st_taluk").get("text");
							if(!answers.containsKey("st_name"))
							{
								if(st_taluk.equals("Thiruvarur Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Komal","Vaipoor","Cholanganallur","Vadakarai","Kunniyur"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Nannilam Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Kuvalaikkal","Mottathur","Adambar","Maruthuvancherry","Achuthamangalam","Mudikondan","Nannilam"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Kodavasal Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"16 Alathur","Ealaiyur","K.k.vanitham","Muhandanur (drier)","Sengalipuram","Seethakkamangalam","Thiruvizhimilalai","Vadaver","Vadugakudi","18 Pudukkudi","Kadamangudi","Thirukkannamangai","Kodavasal (drier)"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Valangaiman Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Vilathur","Haridhuvaramangalam","Alangudi (drier Campus Godown)","Avalivanallur","Kottaiyur","Dpc Avoor"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Mannargudi Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"drop-down","options":{{"value":"0","label":"Edamelaiyur"},{"value":"1","label":"Vaduvoor"},{"value":"2","label":"Edai Keelayur"},{"value":"3","label":"Peraiyur"},{"value":"4","label":"Perugavalnthan (drier)"},{"value":"5","label":"Karuvakkurichy"},{"value":"6","label":"Paravakkottai"},{"value":"7","label":"Thenparai"},{"value":"8","label":"Cholapandi"},{"value":"9","label":"Vattar"},{"value":"10","label":"Sithamalli"},{"value":"11","label":"Panaiyur"},{"value":"12","label":"Ullikkottai"},{"value":"13","label":"Kattakudi"},{"value":"14","label":"Adhichapuram"},{"value":"15","label":"Serumangalam"},{"value":"16","label":"Thirumakkottai"},{"value":"17","label":"Puthakaram"},{"value":"18","label":"Moovarkottai"},{"value":"19","label":"Pudukudi"},{"value":"20","label":"Thalikkottai"},{"value":"21","label":"Renganathapuram"},{"value":"22","label":"Peruvidaimarudur"},{"value":"23","label":"Kummattithidal"},{"value":"24","label":"Radha Narasimmapuram"},{"value":"25","label":"Painganadu"},{"value":"26","label":"Mahadevapattinam"},{"value":"27","label":"Moovanallur"},{"value":"28","label":"Melaputhur"},{"value":"29","label":"Nallur"},{"value":"30","label":"Eda Annavasal"},{"value":"31","label":"Pallivarthi"},{"value":"32","label":"Regunathapuram"},{"value":"33","label":"Sithambur"},{"value":"34","label":"Vadakaravaiyal"}},"select_label":"Select","min_selection":1,"max_selection":1}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Needamangalam Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Munnaval Kottai","Rayapuram","Thevankudi (puduthevankudi)","Mavattakudi","Sonapettai","Thiru Rameswaram (manchanavadi)","Keelamanali","Poovanatham (athanoor)","Pullavarayan Kudikadu","Perampur","Koilvenni (drier)","Moolangudi (drier)","Kunnalur","Poovanoor"}}};
									response.put("questions",{question});
								}
								else if(st_taluk.equals("Thiruthuraipoondi Taluk"))
								{
									question = {"name":"st_name","replies":{"Select your region"},"input":{"type":"select","options":{"Maruthavanam","Sankanthi","Pandichatram","Tiruthangoor","Pamani","Uthayamarthandapuram","Mangudi","Katchanam (drier)","Kokkaladi","Ammalur","Uppur","Melaperumalai","Tirupattur (no.1 Panaiyur)","Ariyalur","Vilakudi"}}};
									response.put("questions",{question});
								}
							}
							else
							{
								st_name = answers.get("st_name").get("text");
								queryValue = Map();
								tlk = "\"Taluk\"=\"" + st_taluk + "\" and \"Name\"=\"" + st_name + "\"";
								queryValue.put("criteria",tlk);
								queryValue.put("start_index","1");
								response_get = zoho.sheet.getRecords("5na57a9fd75df4b164676bc824d0320516243","Sheet1",queryValue);
								query = response_get.get("records");
								details_farmer = query.toCollection();
								address = details_farmer.get("Address");
								response.put("action","end");
								response.put("replies",{"Address is here for you",address," :) Happy Farming!"});
							}
						}
					}
				}
			}
		}
	}
}
else if(context_id.equals("cust"))
{
	cust_actions = answers.get("cust_actions").get("text");
	if(cust_actions.equalsIgnoreCase("Paddy"))
	{
		if(!answers.containsKey("paddy_type"))
		{
			question = {"name":"paddy_type","replies":{"Great! What do you wish to buy?",{"text":"Samba","image":"https://5.imimg.com/data5/GL/SM/MF/ANDROID-25412661/product-jpeg-500x500.jpg"},{"text":"Kuruvai","image":"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRDXh8p4CaFv_NL4a9F3QuhndrD4h16zjVKOg&usqp=CAU"},{"text":"Navara","image":"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcROuRDWfNjm2F3oik3unT8uKo75lnCbL089iw&usqp=CAU"}},"input":{"type":"select","options":{"Kuruvai","Navara","Samba"}}};
			response.put("questions",{question});
		}
		else
		{
			paddy_type = answers.get("paddy_type").get("text");
			queryValue = Map();
			paddy = "\"Crop name\"=\"Paddy\" and \"type\"=\"" + paddy_type + "\"";
			queryValue.put("criteria",paddy);
			queryValue.put("start_index","1");
			response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",queryValue);
			query = response_get.get("records");
			if(query.size() == 0)
			{
				if(!answers.containsKey("customer_email"))
				{
					question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks. ","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
					response.put("questions",{question});
				}
				else
				{
					customer_email = answers.get("customer_email").get("text");
					customer_values = "0,0,0," + customer_email + ",0,Paddy," + paddy_type + ",0,no";
					response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
					response.put("action","end");
					response.put("replies",{"Thank you :)","Happy farming!"});
				}
			}
			else if(query.size() == 1)
			{
				details_farmer = query.toCollection();
				quantity = details_farmer.get("quantity");
				c = 1;
				a = details_farmer.get("Address");
				n = details_farmer.get("Name");
				price = details_farmer.get("price per kg");
				phone_number = details_farmer.get("Phone");
				email = details_farmer.get("Email");
				if(toNumber(quantity) != 0)
				{
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",paddy,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Paddy" + "," + paddy_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",paddy,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Paddy" + "," + paddy_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks. ","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0,Paddy," + paddy_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
			}
			else
			{
				range = List();
				names_list = List();
				prices = List();
				suggestions = List();
				nonzero_index = 0;
				quantity_list = List();
				address_list = List();
				phones = List();
				mails_list = List();
				nonzero = List();
				for each  item in query
				{
					range.add(item);
				}
				options_list = "";
				for each  i in range
				{
					mails_list.add(i.get("Email"));
					phones.add(i.get("Phone"));
					address_list.add(i.get("Address"));
					quantity_list.add(i.get("quantity"));
					names_list.add(i.get("Name"));
					prices.add(i.get("price per kg"));
				}
				for each  qt in quantity_list
				{
					if(toNumber(qt) != 0)
					{
						nonzero.add(quantity_list.indexOf(qt));
					}
				}
				count = 1;
				countlist = List();
				for each  j in nonzero
				{
					suggestions.add(prices.get(j));
					options_list = options_list + toString(count) + ". Address is " + address_list.get(j) + " and price per kilogram is " + prices.get(j) + "@";
					countlist.add(toString(count));
					count = count + 1;
					nonzero_index = j;
				}
				options_list = options_list + "Select any one from the above list";
				list_sugesstions = options_list.toList("@");
				if(suggestions.size() == 0)
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks. ","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0," + "Paddy" + "," + paddy_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
				else if(suggestions.size() == 1)
				{
					quantity = quantity_list.get(nonzero_index);
					a = address_list.get(nonzero_index);
					n = names_list.get(nonzero_index);
					price = prices.get(nonzero_index);
					phone_number = phones.get(nonzero_index);
					email = mails_list.get(nonzero_index);
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",paddy,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Paddy" + "," + paddy_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",paddy,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Paddy" + "," + paddy_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("choice_farm"))
					{
						question = {"name":"choice_farm","replies":list_sugesstions,"input":{"type":"select","options":countlist}};
						response.put("questions",{question});
					}
					else
					{
						choice_farm = answers.get("choice_farm").get("text");
						index_selected = toNumber(choice_farm) - 1;
						farmer_selected = names_list.get(index_selected);
						query_Value = Map();
						name_criteria = "\"Name\"=\"" + farmer_selected + "\"";
						query_Value.put("criteria",name_criteria);
						query_Value.put("start_index","1");
						response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",query_Value);
						records = response_get.get("records");
						details_collection = records.toCollection();
						quantity = details_collection.get("quantity");
						a = details_collection.get("Address");
						n = details_collection.get("Name");
						price = details_collection.get("price per kg");
						phone_number = details_collection.get("Phone");
						email = details_collection.get("Email");
						if(!answers.containsKey("budget"))
						{
							question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
							response.put("questions",{question});
						}
						else
						{
							budget = answers.get("budget").get("text");
							if(!answers.containsKey("submit"))
							{
								question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
								response.put("questions",{question});
							}
							else
							{
								submit = answers.get("submit").get("text");
								if(submit.equals("Confirm"))
								{
									if(!answers.containsKey("mode"))
									{
										question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
										response.put("questions",{question});
									}
									else
									{
										mode = answers.get("mode").get("text");
										if(mode.equals("Online payment"))
										{
											if(!answers.containsKey("id"))
											{
												question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
												response.put("questions",{question});
											}
											else
											{
												id = answers.get("id").get("text");
												url_pay = "https://api.razorpay.com/v1/payments/" + id;
												mapp = Map();
												mapp.put("Content-Type","application/json");
												mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
												response_pay = invokeurl
												[
													url :url_pay
													type :GET
													headers:mapp
													connection:"razorpay_connection"
												];
												status = response_pay.get("status");
												paid = response_pay.get("amount");
												original = toNumber(price) * toNumber(budget) * 100;
												if(status.equals("captured") && paid.equals(original))
												{
													if(!answers.containsKey("customer_name"))
													{
														question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
														response.put("questions",{question});
													}
													else
													{
														customer_name = answers.get("customer_name").get("text");
														if(!answers.containsKey("customer_phone"))
														{
															question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_phone = answers.get("customer_phone").get("text");
															if(!answers.containsKey("customer_email"))
															{
																question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
																response.put("questions",{question});
															}
															else
															{
																customer_email = answers.get("customer_email").get("text");
																if(!answers.containsKey("delivery"))
																{
																	question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																	response.put("questions",{question});
																}
																else
																{
																	delivery = answers.get("delivery").get("text");
																	remaining_quantity = quantity.toNumber() - budget.toNumber();
																	total_amount = budget.toNumber() * price.toNumber();
																	new_values = Map();
																	new_values.put("quantity",remaining_quantity);
																	response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",paddy,new_values);
																	customer_location = "\"" + delivery + "\"";
																	customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Paddy" + "," + paddy_type + "," + mode + ",yes";
																	response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :customer_email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	response.put("action","end");
																	response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
																}
															}
														}
													}
												}
												else
												{
													response.put("action","end");
													response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
												}
											}
										}
										else if(mode.equals("Cash on delivery"))
										{
											if(!answers.containsKey("customer_name"))
											{
												question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
												response.put("questions",{question});
											}
											else
											{
												customer_name = answers.get("customer_name").get("text");
												if(!answers.containsKey("customer_phone"))
												{
													question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_phone = answers.get("customer_phone").get("text");
													if(!answers.containsKey("customer_email"))
													{
														question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_email = answers.get("customer_email").get("text");
														if(!answers.containsKey("delivery"))
														{
															question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
															response.put("questions",{question});
														}
														else
														{
															delivery = answers.get("delivery").get("text");
															remaining_quantity = quantity.toNumber() - budget.toNumber();
															total_amount = budget.toNumber() * price.toNumber();
															new_values = Map();
															new_values.put("quantity",remaining_quantity);
															response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",paddy,new_values);
															customer_location = "\"" + delivery + "\"";
															customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Paddy" + "," + paddy_type + "," + mode + ",yes";
															response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
															sendmail
															[
																from :zoho.adminuserid
																to :customer_email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															sendmail
															[
																from :zoho.adminuserid
																to :email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + paddy_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															response.put("action","end");
															response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
														}
													}
												}
											}
										}
									}
								}
								else
								{
									response.put("action","end");
									response.put("replies",{"Okay :) Happy Farming!"});
								}
							}
						}
					}
				}
			}
		}
	}
	else if(cust_actions.equalsIgnoreCase("Fruits"))
	{
		if(!answers.containsKey("fruits_type"))
		{
			question = {"name":"fruits_type","replies":{"Great! What do you wish to buy?",{"text":"Mango","image":"https://img2.exportersindia.com/product_images/bc-full/dir_62/1845034/fresh-alphonso-mango-562188.jpg"},{"text":"Banana","image":"https://static.toiimg.com/thumb/msid-59711649,width-400,resizemode-4/59711649.jpg"},{"text":"Orange","image":"https://sc01.alicdn.com/kf/HTB1k9C4OXXXXXXjXVXXq6xXFXXX9/99910/HTB1k9C4OXXXXXXjXVXXq6xXFXXX9.jpg"},{"text":"Guava","image":"https://www.gardeningknowhow.com/wp-content/uploads/2017/09/guava-fruit-1.jpg"},{"text":"Lemon","image":"https://www.eatthis.com/wp-content/uploads/sites/4/2020/02/lemons.jpg?fit=1200%2C879&ssl=1"},{"text":"Cashewnut","image":"https://rukminim1.flixcart.com/image/416/416/k0sgl8w0/plant-seed/b/x/f/20-atoz115-atozprintshop-original-imaffxe2t3der7d8.jpeg?q=70"},{"text":"Jackfruit","image":"https://health.clevelandclinic.org/wp-content/uploads/sites/3/2020/12/eatJackfruit-823672534-770x533-1.jpg"},{"text":"Grapes","image":"https://images.immediate.co.uk/production/volatile/sites/30/2020/08/green-grapes-700-350-0084e5e.jpg?quality=90&resize=700,350"},{"text":"Pineapple","image":"https://www.globaltradebazaar.com/files/Products/376_1617795696_Pineapple.jpg"}},"input":{"type":"select","options":{"Mango","Banana","Guava","Lemon","Cashewnut","Jackfruit","Grapes","Orange","Pine apple"}}};
			response.put("questions",{question});
		}
		else
		{
			fruits_type = answers.get("fruits_type").get("text");
			queryValue = Map();
			fruits = "\"Crop name\"=\"Fruits\" and \"type\"=\"" + fruits_type + "\"";
			queryValue.put("criteria",fruits);
			queryValue.put("start_index","1");
			response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",queryValue);
			query = response_get.get("records");
			if(query.size() == 0)
			{
				if(!answers.containsKey("customer_email"))
				{
					question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks. ","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
					response.put("questions",{question});
				}
				else
				{
					customer_email = answers.get("customer_email").get("text");
					customer_values = "0,0,0," + customer_email + ",0,Fruits," + fruits_type + ",0,no";
					response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
					response.put("action","end");
					response.put("replies",{"Thank you :)","Happy farming!"});
				}
			}
			else if(query.size() == 1)
			{
				details_farmer = query.toCollection();
				quantity = details_farmer.get("quantity");
				a = details_farmer.get("Address");
				n = details_farmer.get("Name");
				price = details_farmer.get("price per kg");
				phone_number = details_farmer.get("Phone");
				email = details_farmer.get("Email");
				if(toNumber(quantity) != 0)
				{
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",fruits,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Fruits" + "," + fruits_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",fruits,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Fruits" + "," + fruits_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0,Fruits," + fruits_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
			}
			else
			{
				range = List();
				names_list = List();
				prices = List();
				suggestions = List();
				nonzero_index = 0;
				quantity_list = List();
				address_list = List();
				phones = List();
				mails_list = List();
				nonzero = List();
				for each  item in query
				{
					range.add(item);
				}
				options_list = "";
				for each  i in range
				{
					mails_list.add(i.get("Email"));
					phones.add(i.get("Phone"));
					address_list.add(i.get("Address"));
					quantity_list.add(i.get("quantity"));
					names_list.add(i.get("Name"));
					prices.add(i.get("price per kg"));
				}
				for each  qt in quantity_list
				{
					if(toNumber(qt) != 0)
					{
						nonzero.add(quantity_list.indexOf(qt));
					}
				}
				count = 1;
				countlist = List();
				for each  j in nonzero
				{
					suggestions.add(prices.get(j));
					options_list = options_list + toString(count) + ". Address is " + address_list.get(j) + " and price per kilogram is " + prices.get(j) + "@";
					countlist.add(toString(count));
					count = count + 1;
					nonzero_index = j;
				}
				options_list = options_list + "Select any one from the above list";
				list_sugesstions = options_list.toList("@");
				if(suggestions.size() == 0)
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0,Fruits," + fruits_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
				else if(suggestions.size() == 1)
				{
					quantity = quantity_list.get(nonzero_index);
					a = address_list.get(nonzero_index);
					n = names_list.get(nonzero_index);
					price = prices.get(nonzero_index);
					phone_number = phones.get(nonzero_index);
					email = mails_list.get(nonzero_index);
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",fruits,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Fruits" + "," + fruits_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",fruits,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Fruits" + "," + fruits_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("choice_farm"))
					{
						question = {"name":"choice_farm","replies":list_sugesstions,"input":{"type":"select","options":countlist}};
						response.put("questions",{question});
					}
					else
					{
						choice_farm = answers.get("choice_farm").get("text");
						index_selected = toNumber(choice_farm) - 1;
						farmer_selected = names_list.get(index_selected);
						query_Value = Map();
						name_criteria = "\"Name\"=\"" + farmer_selected + "\"";
						query_Value.put("criteria",name_criteria);
						query_Value.put("start_index","1");
						response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",query_Value);
						records = response_get.get("records");
						details_collection = records.toCollection();
						quantity = details_collection.get("quantity");
						a = details_collection.get("Address");
						n = details_collection.get("Name");
						price = details_collection.get("price per kg");
						phone_number = details_collection.get("Phone");
						email = details_collection.get("Email");
						if(!answers.containsKey("budget"))
						{
							question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
							response.put("questions",{question});
						}
						else
						{
							budget = answers.get("budget").get("text");
							if(!answers.containsKey("submit"))
							{
								question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
								response.put("questions",{question});
							}
							else
							{
								submit = answers.get("submit").get("text");
								if(submit.equals("Confirm"))
								{
									if(!answers.containsKey("mode"))
									{
										question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
										response.put("questions",{question});
									}
									else
									{
										mode = answers.get("mode").get("text");
										if(mode.equals("Online payment"))
										{
											if(!answers.containsKey("id"))
											{
												question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
												response.put("questions",{question});
											}
											else
											{
												id = answers.get("id").get("text");
												url_pay = "https://api.razorpay.com/v1/payments/" + id;
												mapp = Map();
												mapp.put("Content-Type","application/json");
												mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
												response_pay = invokeurl
												[
													url :url_pay
													type :GET
													headers:mapp
													connection:"razorpay_connection"
												];
												status = response_pay.get("status");
												paid = response_pay.get("amount");
												original = toNumber(price) * toNumber(budget) * 100;
												if(status.equals("captured") && paid.equals(original))
												{
													if(!answers.containsKey("customer_name"))
													{
														question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
														response.put("questions",{question});
													}
													else
													{
														customer_name = answers.get("customer_name").get("text");
														if(!answers.containsKey("customer_phone"))
														{
															question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_phone = answers.get("customer_phone").get("text");
															if(!answers.containsKey("customer_email"))
															{
																question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
																response.put("questions",{question});
															}
															else
															{
																customer_email = answers.get("customer_email").get("text");
																if(!answers.containsKey("delivery"))
																{
																	question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																	response.put("questions",{question});
																}
																else
																{
																	delivery = answers.get("delivery").get("text");
																	remaining_quantity = quantity.toNumber() - budget.toNumber();
																	total_amount = budget.toNumber() * price.toNumber();
																	new_values = Map();
																	new_values.put("quantity",remaining_quantity);
																	response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",fruits,new_values);
																	customer_location = "\"" + delivery + "\"";
																	customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Fruits" + "," + fruits_type + "," + mode + ",yes";
																	response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :customer_email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	response.put("action","end");
																	response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
																}
															}
														}
													}
												}
												else
												{
													response.put("action","end");
													response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
												}
											}
										}
										else if(mode.equals("Cash on delivery"))
										{
											if(!answers.containsKey("customer_name"))
											{
												question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
												response.put("questions",{question});
											}
											else
											{
												customer_name = answers.get("customer_name").get("text");
												if(!answers.containsKey("customer_phone"))
												{
													question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_phone = answers.get("customer_phone").get("text");
													if(!answers.containsKey("customer_email"))
													{
														question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_email = answers.get("customer_email").get("text");
														if(!answers.containsKey("delivery"))
														{
															question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
															response.put("questions",{question});
														}
														else
														{
															delivery = answers.get("delivery").get("text");
															remaining_quantity = quantity.toNumber() - budget.toNumber();
															total_amount = budget.toNumber() * price.toNumber();
															new_values = Map();
															new_values.put("quantity",remaining_quantity);
															response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",fruits,new_values);
															customer_location = "\"" + delivery + "\"";
															customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Fruits" + "," + fruits_type + "," + mode + ",yes";
															response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
															sendmail
															[
																from :zoho.adminuserid
																to :customer_email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															sendmail
															[
																from :zoho.adminuserid
																to :email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + fruits_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															response.put("action","end");
															response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
														}
													}
												}
											}
										}
									}
								}
								else
								{
									response.put("action","end");
									response.put("replies",{"Okay :) Happy Farming!"});
								}
							}
						}
					}
				}
			}
		}
	}
	else if(cust_actions.equalsIgnoreCase("Vegetables"))
	{
		if(!answers.containsKey("vegetables_type"))
		{
			question = {"name":"vegetables_type","replies":{"Great! What do you wish to buy?",{"text":"Tapioca","image":"https://cdn.shopify.com/s/files/1/0017/9234/4153/products/tapioca_1200x1200.jpg?v=1630939040"},{"text":"Tomato","image":"https://5.imimg.com/data5/XX/JU/GLADMIN-20349090/fresho-tomato-hybrid-500x500.jpg"},{"text":"Onion","image":"https://5.imimg.com/data5/VE/FO/EY/SELLER-52174092/shallots-onion-500x500.jpg"},{"text":"Brinjal","image":"https://img1.exportersindia.com/product_images/bc-full/dir_171/5121502/brinjal-1502706292-3220074.jpeg"},{"text":"Lady's Finger","image":"https://img2.exportersindia.com/product_images/bc-full/2018/9/5168894/fresh-lady-finger-1536581527-4284529.png"},{"text":"Potato","image":"https://tiimg.tistatic.com/fp/1/005/155/new-harvest-fresh-potato-337.jpg"},{"text":"Cabbage","image":"https://5.imimg.com/data5/ANDROID/Default/2021/6/SK/CP/YV/109848557/product-jpeg-500x500.jpg"},{"text":"Sweet Potato","image":"https://c.ndtvimg.com/2018-10/rn4qsd9_sweet-potatoes-_625x300_10_October_18.jpg"}},"input":{"type":"select","options":{"Tapioca","Tomato","Onion","Brinjal","Lady's Finger","Potato","Cabbage","Sweet potato"}}};
			response.put("questions",{question});
		}
		else
		{
			vegetables_type = answers.get("vegetables_type").get("text");
			queryValue = Map();
			vegetables = "\"Crop name\"=\"Vegetables\" and \"type\"=\"" + vegetables_type + "\"";
			queryValue.put("criteria",vegetables);
			queryValue.put("start_index","1");
			response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",queryValue);
			query = response_get.get("records");
			if(query.size() == 0)
			{
				if(!answers.containsKey("customer_email"))
				{
					question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
					response.put("questions",{question});
				}
				else
				{
					customer_email = answers.get("customer_email").get("text");
					customer_values = "0,0,0," + customer_email + ",0,Vegetables," + vegetables_type + ",0,no";
					response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
					response.put("action","end");
					response.put("replies",{"Thank you :)","Happy farming!"});
				}
			}
			else if(query.size() == 1)
			{
				details_farmer = query.toCollection();
				quantity = details_farmer.get("quantity");
				a = details_farmer.get("Address");
				n = details_farmer.get("Name");
				price = details_farmer.get("price per kg");
				phone_number = details_farmer.get("Phone");
				email = details_farmer.get("Email");
				if(toNumber(quantity) != 0)
				{
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",vegetables,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Vegetables" + "," + vegetables_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",vegetables,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Vegetables" + "," + vegetables_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks. ","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0,Vegetables," + vegetables_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
			}
			else
			{
				range = List();
				names_list = List();
				prices = List();
				suggestions = List();
				nonzero_index = 0;
				quantity_list = List();
				address_list = List();
				phones = List();
				mails_list = List();
				nonzero = List();
				for each  item in query
				{
					range.add(item);
				}
				options_list = "";
				for each  i in range
				{
					mails_list.add(i.get("Email"));
					phones.add(i.get("Phone"));
					address_list.add(i.get("Address"));
					quantity_list.add(i.get("quantity"));
					names_list.add(i.get("Name"));
					prices.add(i.get("price per kg"));
				}
				for each  qt in quantity_list
				{
					if(toNumber(qt) != 0)
					{
						nonzero.add(quantity_list.indexOf(qt));
					}
				}
				count = 1;
				countlist = List();
				for each  j in nonzero
				{
					suggestions.add(prices.get(j));
					options_list = options_list + toString(count) + ". Address is " + address_list.get(j) + " and price per kilogram is " + prices.get(j) + "@";
					countlist.add(toString(count));
					count = count + 1;
					nonzero_index = j;
				}
				options_list = options_list + "Select any one from the above list";
				list_sugesstions = options_list.toList("@");
				if(suggestions.size() == 0)
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0," + "Vegetables" + "," + vegetables_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
				else if(suggestions.size() == 1)
				{
					quantity = quantity_list.get(nonzero_index);
					a = address_list.get(nonzero_index);
					n = names_list.get(nonzero_index);
					price = prices.get(nonzero_index);
					phone_number = phones.get(nonzero_index);
					email = mails_list.get(nonzero_index);
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",vegetables,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Vegetables" + "," + vegetables_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",vegetables,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Vegetables" + "," + vegetables_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("choice_farm"))
					{
						question = {"name":"choice_farm","replies":list_sugesstions,"input":{"type":"select","options":countlist}};
						response.put("questions",{question});
					}
					else
					{
						choice_farm = answers.get("choice_farm").get("text");
						index_selected = toNumber(choice_farm) - 1;
						farmer_selected = names_list.get(index_selected);
						query_Value = Map();
						name_criteria = "\"Name\"=\"" + farmer_selected + "\"";
						query_Value.put("criteria",name_criteria);
						query_Value.put("start_index","1");
						response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",query_Value);
						records = response_get.get("records");
						details_collection = records.toCollection();
						quantity = details_collection.get("quantity");
						a = details_collection.get("Address");
						n = details_collection.get("Name");
						price = details_collection.get("price per kg");
						phone_number = details_collection.get("Phone");
						email = details_collection.get("Email");
						if(!answers.containsKey("budget"))
						{
							question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
							response.put("questions",{question});
						}
						else
						{
							budget = answers.get("budget").get("text");
							if(!answers.containsKey("submit"))
							{
								question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
								response.put("questions",{question});
							}
							else
							{
								submit = answers.get("submit").get("text");
								if(submit.equals("Confirm"))
								{
									if(!answers.containsKey("mode"))
									{
										question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
										response.put("questions",{question});
									}
									else
									{
										mode = answers.get("mode").get("text");
										if(mode.equals("Online payment"))
										{
											if(!answers.containsKey("id"))
											{
												question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
												response.put("questions",{question});
											}
											else
											{
												id = answers.get("id").get("text");
												url_pay = "https://api.razorpay.com/v1/payments/" + id;
												mapp = Map();
												mapp.put("Content-Type","application/json");
												mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
												response_pay = invokeurl
												[
													url :url_pay
													type :GET
													headers:mapp
													connection:"razorpay_connection"
												];
												status = response_pay.get("status");
												paid = response_pay.get("amount");
												original = toNumber(price) * toNumber(budget) * 100;
												if(status.equals("captured") && paid.equals(original))
												{
													if(!answers.containsKey("customer_name"))
													{
														question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
														response.put("questions",{question});
													}
													else
													{
														customer_name = answers.get("customer_name").get("text");
														if(!answers.containsKey("customer_phone"))
														{
															question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_phone = answers.get("customer_phone").get("text");
															if(!answers.containsKey("customer_email"))
															{
																question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
																response.put("questions",{question});
															}
															else
															{
																customer_email = answers.get("customer_email").get("text");
																if(!answers.containsKey("delivery"))
																{
																	question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																	response.put("questions",{question});
																}
																else
																{
																	delivery = answers.get("delivery").get("text");
																	remaining_quantity = quantity.toNumber() - budget.toNumber();
																	total_amount = budget.toNumber() * price.toNumber();
																	new_values = Map();
																	new_values.put("quantity",remaining_quantity);
																	response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",vegetables,new_values);
																	customer_location = "\"" + delivery + "\"";
																	customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Vegetables" + "," + vegetables_type + "," + mode + ",yes";
																	response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :customer_email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	response.put("action","end");
																	response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
																}
															}
														}
													}
												}
												else
												{
													response.put("action","end");
													response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
												}
											}
										}
										else if(mode.equals("Cash on delivery"))
										{
											if(!answers.containsKey("customer_name"))
											{
												question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
												response.put("questions",{question});
											}
											else
											{
												customer_name = answers.get("customer_name").get("text");
												if(!answers.containsKey("customer_phone"))
												{
													question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_phone = answers.get("customer_phone").get("text");
													if(!answers.containsKey("customer_email"))
													{
														question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_email = answers.get("customer_email").get("text");
														if(!answers.containsKey("delivery"))
														{
															question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
															response.put("questions",{question});
														}
														else
														{
															delivery = answers.get("delivery").get("text");
															remaining_quantity = quantity.toNumber() - budget.toNumber();
															total_amount = budget.toNumber() * price.toNumber();
															new_values = Map();
															new_values.put("quantity",remaining_quantity);
															response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",vegetables,new_values);
															customer_location = "\"" + delivery + "\"";
															customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Vegetables" + "," + vegetables_type + "," + mode + ",yes";
															response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
															sendmail
															[
																from :zoho.adminuserid
																to :customer_email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															sendmail
															[
																from :zoho.adminuserid
																to :email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + vegetables_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															response.put("action","end");
															response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
														}
													}
												}
											}
										}
									}
								}
								else
								{
									response.put("action","end");
									response.put("replies",{"Okay :) Happy Farming!"});
								}
							}
						}
					}
				}
			}
		}
	}
	else if(cust_actions.equalsIgnoreCase("Millets"))
	{
		if(!answers.containsKey("millets_type"))
		{
			question = {"name":"millets_type","replies":{"Great! What do you wish to buy?",{"text":"Ragi","image":"https://m.media-amazon.com/images/I/51wy7m+ZLOS.jpg"},{"text":"Maize","image":"https://5.imimg.com/data5/CS/NL/TJ/IOS-4412264/product-jpeg-500x500.png"},{"text":"Samai","image":"https://www.dmtraders.com/wp-content/uploads/2021/05/Little-Millet-Samai.jpg"},{"text":"Cholam","image":"https://3.imimg.com/data3/RJ/CJ/MY-15782097/sorghum-jowar-jola-cholam-juara-500x500.jpg"},{"text":"Cumbu","image":"https://5.imimg.com/data5/GP/XM/ND/SELLER-75209402/cumbu-500x500.jpg"},{"text":"Korra","image":"https://5.imimg.com/data5/WF/WO/FF/SELLER-2544360/millet-foxtail-thennai-yellow-500x500-500x500.jpg"},{"text":"Varagu","image":"https://cdn.shopify.com/s/files/1/2096/1559/products/kodo_900x.jpg?v=1566797549"}},"input":{"type":"select","options":{"Ragi","Maize","Samai","Cholam(Jowar)","Cumbu(Bajra)","Varagu","Korra"}}};
			response.put("questions",{question});
		}
		else
		{
			millets_type = answers.get("millets_type").get("text");
			queryValue = Map();
			m = "\"Crop name\"=\"Millets\" and \"type\"=\"" + millets_type + "\"";
			queryValue.put("criteria",m);
			queryValue.put("start_index","1");
			response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",queryValue);
			query = response_get.get("records");
			if(query.size() == 0)
			{
				if(!answers.containsKey("customer_email"))
				{
					question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
					response.put("questions",{question});
				}
				else
				{
					customer_email = answers.get("customer_email").get("text");
					customer_values = "0,0,0," + customer_email + ",0," + "Millets" + "," + millets_type + ",0,no";
					response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
					response.put("action","end");
					response.put("replies",{"Thank you :)","Happy farming!"});
				}
			}
			else if(query.size() == 1)
			{
				details_farmer = query.toCollection();
				quantity = details_farmer.get("quantity");
				a = details_farmer.get("Address");
				n = details_farmer.get("Name");
				price = details_farmer.get("price per kg");
				phone_number = details_farmer.get("Phone");
				email = details_farmer.get("Email");
				if(toNumber(quantity) != 0)
				{
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",m,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Millets" + "," + millets_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",m,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Millets" + "," + millets_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0,Millets," + millets_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
			}
			else
			{
				range = List();
				names_list = List();
				prices = List();
				suggestions = List();
				nonzero_index = 0;
				quantity_list = List();
				address_list = List();
				phones = List();
				mails_list = List();
				nonzero = List();
				for each  item in query
				{
					range.add(item);
				}
				options_list = "";
				for each  i in range
				{
					mails_list.add(i.get("Email"));
					phones.add(i.get("Phone"));
					address_list.add(i.get("Address"));
					quantity_list.add(i.get("quantity"));
					names_list.add(i.get("Name"));
					prices.add(i.get("price per kg"));
				}
				for each  qt in quantity_list
				{
					if(toNumber(qt) != 0)
					{
						nonzero.add(quantity_list.indexOf(qt));
					}
				}
				count = 1;
				countlist = List();
				for each  j in nonzero
				{
					suggestions.add(prices.get(j));
					options_list = options_list + toString(count) + ". Address is " + address_list.get(j) + " and price per kilogram is " + prices.get(j) + "@";
					countlist.add(toString(count));
					count = count + 1;
					nonzero_index = j;
				}
				options_list = options_list + "Select any one from the above list";
				list_sugesstions = options_list.toList("@");
				if(suggestions.size() == 0)
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0," + "Millets" + "," + millets_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
				else if(suggestions.size() == 1)
				{
					quantity = quantity_list.get(nonzero_index);
					a = address_list.get(nonzero_index);
					n = names_list.get(nonzero_index);
					price = prices.get(nonzero_index);
					phone_number = phones.get(nonzero_index);
					email = mails_list.get(nonzero_index);
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",m,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Millets" + "," + millets_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",m,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Millets" + "," + millets_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("choice_farm"))
					{
						question = {"name":"choice_farm","replies":list_sugesstions,"input":{"type":"select","options":countlist}};
						response.put("questions",{question});
					}
					else
					{
						choice_farm = answers.get("choice_farm").get("text");
						index_selected = toNumber(choice_farm) - 1;
						farmer_selected = names_list.get(index_selected);
						query_Value = Map();
						name_criteria = "\"Name\"=\"" + farmer_selected + "\"";
						query_Value.put("criteria",name_criteria);
						query_Value.put("start_index","1");
						response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",query_Value);
						records = response_get.get("records");
						details_collection = records.toCollection();
						quantity = details_collection.get("quantity");
						a = details_collection.get("Address");
						n = details_collection.get("Name");
						price = details_collection.get("price per kg");
						phone_number = details_collection.get("Phone");
						email = details_collection.get("Email");
						if(!answers.containsKey("budget"))
						{
							question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
							response.put("questions",{question});
						}
						else
						{
							budget = answers.get("budget").get("text");
							if(!answers.containsKey("submit"))
							{
								question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
								response.put("questions",{question});
							}
							else
							{
								submit = answers.get("submit").get("text");
								if(submit.equals("Confirm"))
								{
									if(!answers.containsKey("mode"))
									{
										question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
										response.put("questions",{question});
									}
									else
									{
										mode = answers.get("mode").get("text");
										if(mode.equals("Online payment"))
										{
											if(!answers.containsKey("id"))
											{
												question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
												response.put("questions",{question});
											}
											else
											{
												id = answers.get("id").get("text");
												url_pay = "https://api.razorpay.com/v1/payments/" + id;
												mapp = Map();
												mapp.put("Content-Type","application/json");
												mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
												response_pay = invokeurl
												[
													url :url_pay
													type :GET
													headers:mapp
													connection:"razorpay_connection"
												];
												status = response_pay.get("status");
												paid = response_pay.get("amount");
												original = toNumber(price) * toNumber(budget) * 100;
												if(status.equals("captured") && paid.equals(original))
												{
													if(!answers.containsKey("customer_name"))
													{
														question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
														response.put("questions",{question});
													}
													else
													{
														customer_name = answers.get("customer_name").get("text");
														if(!answers.containsKey("customer_phone"))
														{
															question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_phone = answers.get("customer_phone").get("text");
															if(!answers.containsKey("customer_email"))
															{
																question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
																response.put("questions",{question});
															}
															else
															{
																customer_email = answers.get("customer_email").get("text");
																if(!answers.containsKey("delivery"))
																{
																	question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																	response.put("questions",{question});
																}
																else
																{
																	delivery = answers.get("delivery").get("text");
																	remaining_quantity = quantity.toNumber() - budget.toNumber();
																	total_amount = budget.toNumber() * price.toNumber();
																	new_values = Map();
																	new_values.put("quantity",remaining_quantity);
																	response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",m,new_values);
																	customer_location = "\"" + delivery + "\"";
																	customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Millets" + "," + millets_type + "," + mode + ",yes";
																	response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :customer_email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	response.put("action","end");
																	response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
																}
															}
														}
													}
												}
												else
												{
													response.put("action","end");
													response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
												}
											}
										}
										else if(mode.equals("Cash on delivery"))
										{
											if(!answers.containsKey("customer_name"))
											{
												question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
												response.put("questions",{question});
											}
											else
											{
												customer_name = answers.get("customer_name").get("text");
												if(!answers.containsKey("customer_phone"))
												{
													question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_phone = answers.get("customer_phone").get("text");
													if(!answers.containsKey("customer_email"))
													{
														question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_email = answers.get("customer_email").get("text");
														if(!answers.containsKey("delivery"))
														{
															question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
															response.put("questions",{question});
														}
														else
														{
															delivery = answers.get("delivery").get("text");
															remaining_quantity = quantity.toNumber() - budget.toNumber();
															total_amount = budget.toNumber() * price.toNumber();
															new_values = Map();
															new_values.put("quantity",remaining_quantity);
															response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",m,new_values);
															customer_location = "\"" + delivery + "\"";
															customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Millets" + "," + millets_type + "," + mode + ",yes";
															response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
															sendmail
															[
																from :zoho.adminuserid
																to :customer_email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															sendmail
															[
																from :zoho.adminuserid
																to :email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + millets_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															response.put("action","end");
															response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
														}
													}
												}
											}
										}
									}
								}
								else
								{
									response.put("action","end");
									response.put("replies",{"Okay :) Happy Farming!"});
								}
							}
						}
					}
				}
			}
		}
	}
	else if(cust_actions.equalsIgnoreCase("Spices & Condiments"))
	{
		if(!answers.containsKey("spices_type"))
		{
			question = {"name":"spices_type","replies":{"Great! What do you wish to buy?",{"text":"Chillies(Dry)","image":"https://m.media-amazon.com/images/I/51COcL57F1L.jpg"},{"text":"Tamarid","image":"https://static.toiimg.com/photo/84383838.cms"},{"text":"Turmeric(Cured)","image":"https://static.toiimg.com/thumb/69323668.cms?width=400&height=300&resizemode=4&imgsize=604599"},{"text":"Pepper","image":"https://akm-img-a-in.tosshub.com/sites/rd/resources/202006/blackpepper_1591428421_1200x675.png?size=684:384?size=1200:675"},{"text":"Arecanut","image":"https://cdn.tridge.com/image/original/df/b3/fb/dfb3fbf2ffbd2744d05d80df160ec14b97109422.jpg"},{"text":"Coiandern(Grains)","image":"https://5.imimg.com/data5/ON/IM/MY-22166480/coriander-seed-905294-500x500.jpg"},{"text":"Cardomom","image":"http://nearbyshop.in/images/detailed/9/image_23_s6rb-zi.jpg"},{"text":"Cloves","image":"https://post.healthline.com/wp-content/uploads/2020/01/cloves-on-wooden-spoon-800x728.jpg"},{"text":"Ginger","image":"https://post.medicalnewstoday.com/wp-content/uploads/sites/3/2020/02/265990_1100-1100x628.jpg"}},"input":{"type":"select","options":{"Chillies(Dry)","Tamarid","Turmeric(Cured)","Pepper","Arecanut","Coiandern(Grains)","Cardomom","Cloves","Ginger"}}};
			response.put("questions",{question});
		}
		else
		{
			spices_type = answers.get("spices_type").get("text");
			queryValue = Map();
			spices = "\"Crop name\"=\"Spices & Condiments\" and \"type\"=\"" + spices_type + "\"";
			queryValue.put("criteria",spices);
			queryValue.put("start_index","1");
			response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",queryValue);
			query = response_get.get("records");
			if(query.size() == 0)
			{
				if(!answers.containsKey("customer_email"))
				{
					question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
					response.put("questions",{question});
				}
				else
				{
					customer_email = answers.get("customer_email").get("text");
					customer_values = "0,0,0," + customer_email + ",0," + "Spices & Condiments" + "," + spices_type + ",0,no";
					response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
					response.put("action","end");
					response.put("replies",{"Thank you :)","Happy farming!"});
				}
			}
			else if(query.size() == 1)
			{
				details_farmer = query.toCollection();
				quantity = details_farmer.get("quantity");
				a = details_farmer.get("Address");
				n = details_farmer.get("Name");
				price = details_farmer.get("price per kg");
				phone_number = details_farmer.get("Phone");
				email = details_farmer.get("Email");
				if(toNumber(quantity) != 0)
				{
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",spices,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Spices & Condiments" + "," + spices_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",spices,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Spices & Condiments" + "," + spices_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0,Spices & Condiments," + spices_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
			}
			else
			{
				range = List();
				names_list = List();
				prices = List();
				suggestions = List();
				nonzero_index = 0;
				quantity_list = List();
				address_list = List();
				phones = List();
				mails_list = List();
				nonzero = List();
				for each  item in query
				{
					range.add(item);
				}
				options_list = "";
				for each  i in range
				{
					mails_list.add(i.get("Email"));
					phones.add(i.get("Phone"));
					address_list.add(i.get("Address"));
					quantity_list.add(i.get("quantity"));
					names_list.add(i.get("Name"));
					prices.add(i.get("price per kg"));
				}
				for each  qt in quantity_list
				{
					if(toNumber(qt) != 0)
					{
						nonzero.add(quantity_list.indexOf(qt));
					}
				}
				count = 1;
				countlist = List();
				for each  j in nonzero
				{
					suggestions.add(prices.get(j));
					options_list = options_list + toString(count) + ". Address is " + address_list.get(j) + " and price per kilogram is " + prices.get(j) + "@";
					countlist.add(toString(count));
					count = count + 1;
					nonzero_index = j;
				}
				options_list = options_list + "Select any one from the above list";
				list_sugesstions = options_list.toList("@");
				if(suggestions.size() == 0)
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0," + "Spices & Condiments" + "," + spices_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
				else if(suggestions.size() == 1)
				{
					quantity = quantity_list.get(nonzero_index);
					a = address_list.get(nonzero_index);
					n = names_list.get(nonzero_index);
					price = prices.get(nonzero_index);
					phone_number = phones.get(nonzero_index);
					email = mails_list.get(nonzero_index);
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",spices,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Spices & Condiments" + "," + spices_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",spices,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Spices & Condiments" + "," + spices_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("choice_farm"))
					{
						question = {"name":"choice_farm","replies":list_sugesstions,"input":{"type":"select","options":countlist}};
						response.put("questions",{question});
					}
					else
					{
						choice_farm = answers.get("choice_farm").get("text");
						index_selected = toNumber(choice_farm) - 1;
						farmer_selected = names_list.get(index_selected);
						query_Value = Map();
						name_criteria = "\"Name\"=\"" + farmer_selected + "\"";
						query_Value.put("criteria",name_criteria);
						query_Value.put("start_index","1");
						response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",query_Value);
						records = response_get.get("records");
						details_collection = records.toCollection();
						quantity = details_collection.get("quantity");
						a = details_collection.get("Address");
						n = details_collection.get("Name");
						price = details_collection.get("price per kg");
						phone_number = details_collection.get("Phone");
						email = details_collection.get("Email");
						if(!answers.containsKey("budget"))
						{
							question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
							response.put("questions",{question});
						}
						else
						{
							budget = answers.get("budget").get("text");
							if(!answers.containsKey("submit"))
							{
								question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
								response.put("questions",{question});
							}
							else
							{
								submit = answers.get("submit").get("text");
								if(submit.equals("Confirm"))
								{
									if(!answers.containsKey("mode"))
									{
										question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
										response.put("questions",{question});
									}
									else
									{
										mode = answers.get("mode").get("text");
										if(mode.equals("Online payment"))
										{
											if(!answers.containsKey("id"))
											{
												question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
												response.put("questions",{question});
											}
											else
											{
												id = answers.get("id").get("text");
												url_pay = "https://api.razorpay.com/v1/payments/" + id;
												mapp = Map();
												mapp.put("Content-Type","application/json");
												mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
												response_pay = invokeurl
												[
													url :url_pay
													type :GET
													headers:mapp
													connection:"razorpay_connection"
												];
												status = response_pay.get("status");
												paid = response_pay.get("amount");
												original = toNumber(price) * toNumber(budget) * 100;
												if(status.equals("captured") && paid.equals(original))
												{
													if(!answers.containsKey("customer_name"))
													{
														question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
														response.put("questions",{question});
													}
													else
													{
														customer_name = answers.get("customer_name").get("text");
														if(!answers.containsKey("customer_phone"))
														{
															question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_phone = answers.get("customer_phone").get("text");
															if(!answers.containsKey("customer_email"))
															{
																question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
																response.put("questions",{question});
															}
															else
															{
																customer_email = answers.get("customer_email").get("text");
																if(!answers.containsKey("delivery"))
																{
																	question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																	response.put("questions",{question});
																}
																else
																{
																	delivery = answers.get("delivery").get("text");
																	remaining_quantity = quantity.toNumber() - budget.toNumber();
																	total_amount = budget.toNumber() * price.toNumber();
																	new_values = Map();
																	new_values.put("quantity",remaining_quantity);
																	response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",spices,new_values);
																	customer_location = "\"" + delivery + "\"";
																	customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Spices & Condiments" + "," + spices_type + "," + mode + ",yes";
																	response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :customer_email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	response.put("action","end");
																	response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
																}
															}
														}
													}
												}
												else
												{
													response.put("action","end");
													response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
												}
											}
										}
										else if(mode.equals("Cash on delivery"))
										{
											if(!answers.containsKey("customer_name"))
											{
												question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
												response.put("questions",{question});
											}
											else
											{
												customer_name = answers.get("customer_name").get("text");
												if(!answers.containsKey("customer_phone"))
												{
													question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_phone = answers.get("customer_phone").get("text");
													if(!answers.containsKey("customer_email"))
													{
														question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_email = answers.get("customer_email").get("text");
														if(!answers.containsKey("delivery"))
														{
															question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
															response.put("questions",{question});
														}
														else
														{
															delivery = answers.get("delivery").get("text");
															remaining_quantity = quantity.toNumber() - budget.toNumber();
															total_amount = budget.toNumber() * price.toNumber();
															new_values = Map();
															new_values.put("quantity",remaining_quantity);
															response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",spices,new_values);
															customer_location = "\"" + delivery + "\"";
															customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Spices & Condiments" + "," + spices_type + "," + mode + ",yes";
															response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
															sendmail
															[
																from :zoho.adminuserid
																to :customer_email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															sendmail
															[
																from :zoho.adminuserid
																to :email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + spices_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															response.put("action","end");
															response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
														}
													}
												}
											}
										}
									}
								}
								else
								{
									response.put("action","end");
									response.put("replies",{"Okay :) Happy Farming!"});
								}
							}
						}
					}
				}
			}
		}
	}
	else if(cust_actions.equalsIgnoreCase("Pulses"))
	{
		if(!answers.containsKey("pulses_type"))
		{
			question = {"name":"pulses_type","replies":{"Great! What do you wish to buy?",{"text":"Black gram","image":"https://assets.thehansindia.com/hansindia-bucket/1587_Black-Gram-Seeds-Urad-Dal-s.jpg"},{"text":"Green gram","image":"https://m.media-amazon.com/images/I/91X3uTBjNHL._SX679_.jpg"},{"text":"Horse gram","image":"https://post.healthline.com/wp-content/uploads/2021/02/horse-gram-1200x628-facebook-1200x628.jpg"},{"text":"Red gram","image":"https://www.thevillagenaturals.com/wp-content/uploads/2020/09/Pigeon-Peas.jpg"},{"text":"Bengal gram","image":"https://3.imimg.com/data3/RR/IA/MY-11548528/bengal-gram-500x500.jpg"}},"input":{"type":"select","options":{"Black gram","Green gram","Red gram","Horse gram","Bengal gram"}}};
			response.put("questions",{question});
		}
		else
		{
			pulses_type = answers.get("pulses_type").get("text");
			queryValue = Map();
			pulses = "\"Crop name\"=\"Pulses\" and \"type\"=\"" + pulses_type + "\"";
			queryValue.put("criteria",pulses);
			queryValue.put("start_index","1");
			response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",queryValue);
			query = response_get.get("records");
			if(query.size() == 0)
			{
				if(!answers.containsKey("customer_email"))
				{
					question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
					response.put("questions",{question});
				}
				else
				{
					customer_email = answers.get("customer_email").get("text");
					customer_values = "0,0,0," + customer_email + ",0,Pulses," + pulses_type + ",0,no";
					response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
					response.put("action","end");
					response.put("replies",{"Thank you :)","Happy farming!"});
				}
			}
			else if(query.size() == 1)
			{
				details_farmer = query.toCollection();
				quantity = details_farmer.get("quantity");
				a = details_farmer.get("Address");
				n = details_farmer.get("Name");
				price = details_farmer.get("price per kg");
				phone_number = details_farmer.get("Phone");
				email = details_farmer.get("Email");
				if(toNumber(quantity) != 0)
				{
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",pulses,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Pulses" + "," + pulses_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",pulses,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Pulses" + "," + pulses_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks. ","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0,Pulses," + pulses_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
			}
			else
			{
				range = List();
				names_list = List();
				prices = List();
				suggestions = List();
				nonzero_index = 0;
				quantity_list = List();
				address_list = List();
				phones = List();
				mails_list = List();
				nonzero = List();
				for each  item in query
				{
					range.add(item);
				}
				options_list = "";
				for each  i in range
				{
					mails_list.add(i.get("Email"));
					phones.add(i.get("Phone"));
					address_list.add(i.get("Address"));
					quantity_list.add(i.get("quantity"));
					names_list.add(i.get("Name"));
					prices.add(i.get("price per kg"));
				}
				for each  qt in quantity_list
				{
					if(toNumber(qt) != 0)
					{
						nonzero.add(quantity_list.indexOf(qt));
					}
				}
				count = 1;
				countlist = List();
				for each  j in nonzero
				{
					suggestions.add(prices.get(j));
					options_list = options_list + toString(count) + ". Address is " + address_list.get(j) + " and price per kilogram is " + prices.get(j) + "@";
					countlist.add(toString(count));
					count = count + 1;
					nonzero_index = j;
				}
				options_list = options_list + "Select any one from the above list";
				list_sugesstions = options_list.toList("@");
				if(suggestions.size() == 0)
				{
					if(!answers.containsKey("customer_email"))
					{
						question = {"name":"customer_email","replies":{"I'm very sorry, but the product that you have asked is not in stock!","I'm sure that I will inform you when we have the stocks.","Can I have your mail id ? "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
						response.put("questions",{question});
					}
					else
					{
						customer_email = answers.get("customer_email").get("text");
						customer_values = "0,0,0," + customer_email + ",0,Pulses," + pulses_type + ",0,no";
						response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
						response.put("action","end");
						response.put("replies",{"Thank you :)","Happy farming!"});
					}
				}
				else if(suggestions.size() == 1)
				{
					quantity = quantity_list.get(nonzero_index);
					a = address_list.get(nonzero_index);
					n = names_list.get(nonzero_index);
					price = prices.get(nonzero_index);
					phone_number = phones.get(nonzero_index);
					email = mails_list.get(nonzero_index);
					if(!answers.containsKey("budget"))
					{
						question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
						response.put("questions",{question});
					}
					else
					{
						budget = answers.get("budget").get("text");
						if(!answers.containsKey("submit"))
						{
							question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kilogram :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
							response.put("questions",{question});
						}
						else
						{
							submit = answers.get("submit").get("text");
							if(submit.equals("Confirm"))
							{
								if(!answers.containsKey("mode"))
								{
									question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
									response.put("questions",{question});
								}
								else
								{
									mode = answers.get("mode").get("text");
									if(mode.equals("Online payment"))
									{
										if(!answers.containsKey("id"))
										{
											question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
											response.put("questions",{question});
										}
										else
										{
											id = answers.get("id").get("text");
											url_pay = "https://api.razorpay.com/v1/payments/" + id;
											mapp = Map();
											mapp.put("Content-Type","application/json");
											mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
											response_pay = invokeurl
											[
												url :url_pay
												type :GET
												headers:mapp
												connection:"razorpay_connection"
											];
											status = response_pay.get("status");
											paid = response_pay.get("amount");
											original = toNumber(price) * toNumber(budget) * 100;
											if(status.equals("captured") && paid.equals(original))
											{
												if(!answers.containsKey("customer_name"))
												{
													question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
													response.put("questions",{question});
												}
												else
												{
													customer_name = answers.get("customer_name").get("text");
													if(!answers.containsKey("customer_phone"))
													{
														question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_phone = answers.get("customer_phone").get("text");
														if(!answers.containsKey("customer_email"))
														{
															question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_email = answers.get("customer_email").get("text");
															if(!answers.containsKey("delivery"))
															{
																question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																response.put("questions",{question});
															}
															else
															{
																delivery = answers.get("delivery").get("text");
																remaining_quantity = quantity.toNumber() - budget.toNumber();
																total_amount = budget.toNumber() * price.toNumber();
																new_values = Map();
																new_values.put("quantity",remaining_quantity);
																response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",pulses,new_values);
																customer_location = "\"" + delivery + "\"";
																customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Pulses" + "," + pulses_type + "," + mode + ",yes";
																response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																sendmail
																[
																	from :zoho.adminuserid
																	to :customer_email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																sendmail
																[
																	from :zoho.adminuserid
																	to :email
																	subject :"Order confirmation"
																	message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																]
																response.put("action","end");
																response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
															}
														}
													}
												}
											}
											else
											{
												response.put("action","end");
												response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
											}
										}
									}
									else if(mode.equals("Cash on delivery"))
									{
										if(!answers.containsKey("customer_name"))
										{
											question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
											response.put("questions",{question});
										}
										else
										{
											customer_name = answers.get("customer_name").get("text");
											if(!answers.containsKey("customer_phone"))
											{
												question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
												response.put("questions",{question});
											}
											else
											{
												customer_phone = answers.get("customer_phone").get("text");
												if(!answers.containsKey("customer_email"))
												{
													question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_email = answers.get("customer_email").get("text");
													if(!answers.containsKey("delivery"))
													{
														question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
														response.put("questions",{question});
													}
													else
													{
														delivery = answers.get("delivery").get("text");
														remaining_quantity = quantity.toNumber() - budget.toNumber();
														total_amount = budget.toNumber() * price.toNumber();
														new_values = Map();
														new_values.put("quantity",remaining_quantity);
														response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",pulses,new_values);
														customer_location = "\"" + delivery + "\"";
														customer_values = customer_name + "," + customer_phone + "," + customer_location + "," + customer_email + "," + total_amount + "," + "Pulses" + "," + pulses_type + "," + mode + ",yes";
														response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
														sendmail
														[
															from :zoho.adminuserid
															to :customer_email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														sendmail
														[
															from :zoho.adminuserid
															to :email
															subject :"Order confirmation"
															message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
														]
														response.put("action","end");
														response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
													}
												}
											}
										}
									}
								}
							}
							else
							{
								response.put("action","end");
								response.put("replies",{"Okay :) Happy Farming!"});
							}
						}
					}
				}
				else
				{
					if(!answers.containsKey("choice_farm"))
					{
						question = {"name":"choice_farm","replies":list_sugesstions,"input":{"type":"select","options":countlist}};
						response.put("questions",{question});
					}
					else
					{
						choice_farm = answers.get("choice_farm").get("text");
						index_selected = toNumber(choice_farm) - 1;
						farmer_selected = names_list.get(index_selected);
						query_Value = Map();
						name_criteria = "\"Name\"=\"" + farmer_selected + "\"";
						query_Value.put("criteria",name_criteria);
						query_Value.put("start_index","1");
						response_get = zoho.sheet.getRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",query_Value);
						records = response_get.get("records");
						details_collection = records.toCollection();
						quantity = details_collection.get("quantity");
						a = details_collection.get("Address");
						n = details_collection.get("Name");
						price = details_collection.get("price per kg");
						phone_number = details_collection.get("Phone");
						email = details_collection.get("Email");
						if(!answers.containsKey("budget"))
						{
							question = {"name":"budget","replies":{"Quantity availble : " + quantity,"Nice :) How much do you want?"},"input":{"type":"slider","values":{"0","1","2","3","4","5","6","7","8","9","10"}}};
							response.put("questions",{question});
						}
						else
						{
							budget = answers.get("budget").get("text");
							if(!answers.containsKey("submit"))
							{
								question = {"name":"submit","replies":{"Farmer details is here for you !","Address :" + a,"Price per kg :" + price,"Order Confirmation :) "},"input":{"type":"select","options":{"Confirm","Nope"}}};
								response.put("questions",{question});
							}
							else
							{
								submit = answers.get("submit").get("text");
								if(submit.equals("Confirm"))
								{
									if(!answers.containsKey("mode"))
									{
										question = {"name":"mode","replies":{"Total amount :" + toString(toNumber(price) * toNumber(budget)),"Which mode do you prefer ?"},"input":{"type":"select","options":{"Online payment","Cash on delivery"}}};
										response.put("questions",{question});
									}
									else
									{
										mode = answers.get("mode").get("text");
										if(mode.equals("Online payment"))
										{
											if(!answers.containsKey("id"))
											{
												question = {"name":"id","replies":{{"text":"Click on the link for payment.After you paid the amount give us the payment i'd below. The payment i'd will be sent to your given email.","type":"links","links":{{"text":"Click here","url":"https://rzp.io/l/eJknXPUl"}}}}};
												response.put("questions",{question});
											}
											else
											{
												id = answers.get("id").get("text");
												url_pay = "https://api.razorpay.com/v1/payments/" + id;
												mapp = Map();
												mapp.put("Content-Type","application/json");
												mapp.put("Authorization","Basic " + zoho.encryption.base64Encode("rzp_test_3VXqLyIYrkykus:nkc3og7M7F3vd9qHmer6MYnK"));
												response_pay = invokeurl
												[
													url :url_pay
													type :GET
													headers:mapp
													connection:"razorpay_connection"
												];
												status = response_pay.get("status");
												paid = response_pay.get("amount");
												original = toNumber(price) * toNumber(budget) * 100;
												if(status.equals("captured") && paid.equals(original))
												{
													if(!answers.containsKey("customer_name"))
													{
														question = {"name":"customer_name","replies":{"Payment successfull !","May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
														response.put("questions",{question});
													}
													else
													{
														customer_name = answers.get("customer_name").get("text");
														if(!answers.containsKey("customer_phone"))
														{
															question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
															response.put("questions",{question});
														}
														else
														{
															customer_phone = answers.get("customer_phone").get("text");
															if(!answers.containsKey("customer_email"))
															{
																question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
																response.put("questions",{question});
															}
															else
															{
																customer_email = answers.get("customer_email").get("text");
																if(!answers.containsKey("delivery"))
																{
																	question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
																	response.put("questions",{question});
																}
																else
																{
																	delivery = answers.get("delivery").get("text");
																	remaining_quantity = quantity.toNumber() - budget.toNumber();
																	total_amount = budget.toNumber() * price.toNumber();
																	new_values = Map();
																	new_values.put("quantity",remaining_quantity);
																	response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",pulses,new_values);
																	customer_values = customer_name + "," + customer_phone + "," + "\"" + delivery + "\"" + "," + customer_email + "," + total_amount + "," + "Pulses" + "," + pulses_type + "," + mode + ",yes";
																	response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :customer_email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	sendmail
																	[
																		from :zoho.adminuserid
																		to :email
																		subject :"Order confirmation"
																		message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
																	]
																	response.put("action","end");
																	response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
																}
															}
														}
													}
												}
												else
												{
													response.put("action","end");
													response.put("replies",{"Payment Unsuccessfull ! Please try again later."});
												}
											}
										}
										else if(mode.equals("Cash on delivery"))
										{
											if(!answers.containsKey("customer_name"))
											{
												question = {"name":"customer_name","replies":{"May I know your name ?"},"input":{"type":"name","placeholder":"Enter your name"}};
												response.put("questions",{question});
											}
											else
											{
												customer_name = answers.get("customer_name").get("text");
												if(!answers.containsKey("customer_phone"))
												{
													question = {"name":"customer_phone","replies":{"Can I have your phone number ?"},"input":{"type":"tel","placeholder":"Enter your phone number","error":{"Enter a valid phone number"}}};
													response.put("questions",{question});
												}
												else
												{
													customer_phone = answers.get("customer_phone").get("text");
													if(!answers.containsKey("customer_email"))
													{
														question = {"name":"customer_email","replies":{"Give us your mail id "},"input":{"type":"email","placeholder":"Enter your email","error":{"Enter a valid email"}}};
														response.put("questions",{question});
													}
													else
													{
														customer_email = answers.get("customer_email").get("text");
														if(!answers.containsKey("delivery"))
														{
															question = {"name":"delivery","replies":{"Choose your location"},"input":{"type":"location"}};
															response.put("questions",{question});
														}
														else
														{
															delivery = answers.get("delivery").get("text");
															remaining_quantity = quantity.toNumber() - budget.toNumber();
															total_amount = budget.toNumber() * price.toNumber();
															new_values = Map();
															new_values.put("quantity",remaining_quantity);
															response_update = zoho.sheet.updateRecords("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet1",pulses,new_values);
															customer_values = customer_name + "," + customer_phone + "," + "\"" + delivery + "\"" + "," + customer_email + "," + total_amount + "," + "Pulses" + "," + pulses_type + "," + mode + ",yes";
															response_insert = zoho.sheet.insertCSV("fwfv586b1d3682bf64dbcbfac4b798d915d4b","Sheet2",customer_values);
															sendmail
															[
																from :zoho.adminuserid
																to :customer_email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>Your order has been confirmed" + "<br>Farmer Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Your Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															sendmail
															[
																from :zoho.adminuserid
																to :email
																subject :"Order confirmation"
																message :"Dear Customer, " + "<br>An order for your product has been confirmed" + "<br>Your Details:" + "<br>Name:" + n + "<br>Email:" + email + "<br>Phone no:" + phone_number + "<br>Address:" + a + "<br><br>Customer Details:" + "<br>Name:" + customer_name + "<br>Email:" + customer_email + "<br>Phone no:" + customer_phone + "<br>Address:" + customer_location + "<br> Product name:" + pulses_type + "<br>Total price: Rs." + total_amount + "<br>Mode of Buying:" + mode
															]
															response.put("action","end");
															response.put("replies",{"Your order is successfully confirmed. You will receive an email with order confirmation"," Happy farming :)"});
														}
													}
												}
											}
										}
									}
								}
								else
								{
									response.put("action","end");
									response.put("replies",{"Okay :) Happy Farming!"});
								}
							}
						}
					}
				}
			}
		}
	}
}
return response;